# Face Tracking  

Суть проекта заключается в разработке модели, которая будет распознавать лица на изображении. Данная модель пригодится мне в дальнейшем для других проектов.

## Требования: 
1. Модель должна быстро работать и мало весить (в дальнейшем предполагается использование на Raspberry pi).  
2. Есть всего два класса — background и лицо. Модель должна детектировать лица с достаточной точностью (вблизи должна распознавать их околоидеально).  
3. По размерам обнаруженных объектов должен находиться самый маленький из них.  
4. Программа должна рассчитывать расстояние от центра изображения до центра каждого из объектов.  
5. Потенциально нужно будет сделать трекинг.

## План работы:  
- ~~1-ый день. Подготовить проект к началу работы — гит-репозиторий, докер и т.п.~~  
- ~~2-ой день. Определиться с используемой моделью, а также с разрешением фото. Подобрать датасет для transfer-learning, подобрать инструмент для разметки этого датасета (для детектирования).~~  
- ~~3-ий и 4-ый день. Дообучить модель, протестировать её на своих данных.~~  
- ~~5-ый день. Добавить расчёт расстояния от центра изображения до центра каждого объекта. Добавить нахождение самого крупного объекта. Добавить какое-нибудь обозначение, когда центр изображения попадает внутрь рамки объекта (не обязательно в центр объекта).~~  

В будущем:  
Добавить Raspberry pi, купить к нему камеру, поставить нейронку на микроконтроллер.

## Ход работы:
1. Гит-репозиторий и докер-файл подготовил, тут ничего особенного.
2. Т.к. нужна быстрая модель с приемлемым качеством детектирования, выбор стоял между какой-нибудь компактной версией YOLO и SSDLite. 
Для YOLO у Ultralytics есть подробное руководство по использованию с Raspberry pi, 
а также соответствующие бенчмарки. Для SSDLite есть различные инструкции и статьи по работе с Raspberry pi, 
но они выглядят хаотично, по сравнению с YOLO. Поэтому предварительно была выбрана YOLO. 
Разрешение изображения, как оказалось, не принципиально (я ранее думал, что есть какие-то ограничения, 
связанные с камерой, но там все камеры могут делать снимки и записывать видео в достаточно высоком разрешении). 
Разрешение выбрано 640x640. В качестве тренировочного датасета использовался WIDER_FACE: http://shuoyang1213.me/WIDERFACE/. 
Этот датасет подготовлен в формате, отличающемся от требуемого мне формата, поэтому я взял те же данные, 
но в нужном мне формате, отсюда: https://github.com/strdsx/WiderFace_to_YOLO/tree/master.  
3. Модель обучалась на CPU в течение 9.5 часов — вышло 6 эпох. Параметры обучения в файле train_face_detector.py. 
Очевидно, модели ещё есть куда обучаться, но я пока что решил на этом остановиться. Чтобы проверить её работу, 
сделал трекинг с видеокамеры с opencv (файл camera_face_tracking.py).  
4. Удалил Dockerfile, т.к. в проекте используется всего пара библиотек. Докер-контейнер здесь просто лишний.
5. Добавил расчёт расстояния и размера объектов, а также проверку, находится ли объект в центре изображения.